description: >
  Publish a docker image to docker hub from a previously built *image.tar*

parameters:
  image_name:
    type: string
  registry_pwd:
    default: ""
    type: string
  registry_user:
    default: ""
    type: string
  version:
    default: "0.0.0"
    type: string
  latest_version:
    default: "latest"
    type: string

steps:
  - when:
      condition: <<parameters.registry_user>>
      steps:
        - run:
            name: Login to docker registry
            command: echo << parameters.registry_pwd >> | docker login -u << parameters.registry_user >> --password-stdin
  - run:
      name: Load docker image from cache
      command: |
        docker import image.tar << parameters.image_name >>:<< parameters.version >>
        docker import image.tar << parameters.image_name >>:<< parameters.latest_version >>
  - run:
      name: Publishing image
      command: |
        docker push << parameters.image_name >>:<< parameters.version >>
        docker push << parameters.image_name >>:<< parameters.latest_version >>
